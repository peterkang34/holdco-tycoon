import { EventType, SectorId } from '../engine/types';

export interface EventDefinition {
  type: EventType;
  title: string;
  description: string;
  probability: number; // 0-1
  effectDescription: string;
  tip?: string;
  tipSource?: string;
}

export const GLOBAL_EVENTS: EventDefinition[] = [
  {
    type: 'global_bull_market',
    title: 'Bull Market',
    description: 'Investor optimism is running high. Valuations are up across the board.',
    probability: 0.08,
    effectDescription: 'All opcos +5-15% EBITDA; exit multiples +0.5x this round',
    tip: 'Bull markets are great for exits, but don\'t overpay for acquisitions when everyone is euphoric.',
    tipSource: 'Ch. VI',
  },
  {
    type: 'global_recession',
    title: 'Economic Recession',
    description: 'The economy contracts. Consumer and business spending drops.',
    probability: 0.06,
    effectDescription: 'EBITDA drops based on each sector\'s recession sensitivity',
    tip: 'Berkshire thrives in recessions because Buffett keeps powder dry. Cash is your competitive advantage when others are desperate.',
    tipSource: 'Ch. VI',
  },
  {
    type: 'global_interest_hike',
    title: 'Interest Rate Hike',
    description: 'The Fed raises rates to combat inflation.',
    probability: 0.07,
    effectDescription: 'Interest rate +1-2%',
    tip: 'TransDigm uses debt strategically but always ensures cash flows can cover interest even in a downturn.',
    tipSource: 'Ch. VII',
  },
  {
    type: 'global_interest_cut',
    title: 'Interest Rate Cut',
    description: 'The Fed cuts rates to stimulate growth.',
    probability: 0.06,
    effectDescription: 'Interest rate -1-2%',
    tip: 'Lower rates make debt cheaper, but don\'t let cheap financing tempt you into bad deals.',
  },
  {
    type: 'global_inflation',
    title: 'Inflation Spike',
    description: 'Supply chain disruptions drive costs higher across the economy.',
    probability: 0.05,
    effectDescription: 'Capex rates +3% for 2 rounds',
    tip: 'Pricing power is the best inflation hedge. Businesses that can pass costs through to customers will survive.',
    tipSource: 'Ch. III',
  },
  {
    type: 'global_credit_tightening',
    title: 'Credit Tightening',
    description: 'Banks pull back on lending. Credit becomes harder to access.',
    probability: 0.04,
    effectDescription: 'No debt-financed acquisitions for 2 rounds',
    tip: 'When credit tightens, cash-rich holdcos can find bargains. This is when discipline pays off.',
    tipSource: 'Ch. VI',
  },
  {
    type: 'global_quiet',
    title: 'Quiet Year',
    description: 'Markets are stable. Business as usual.',
    probability: 0.22,
    effectDescription: 'No special effects',
  },
];

export const PORTFOLIO_EVENTS: EventDefinition[] = [
  {
    type: 'portfolio_star_joins',
    title: 'Star Operator Joins',
    description: 'A talented executive joins one of your portfolio companies.',
    probability: 0.08,
    effectDescription: '+12% EBITDA, +2% growth rate for one opco',
    tip: 'Constellation Software ties bonuses to ROIC. Great talent stays when incentives align.',
    tipSource: 'Ch. VIII',
  },
  {
    type: 'portfolio_talent_leaves',
    title: 'Key Talent Leaves',
    description: 'A critical team member departs from one of your businesses.',
    probability: 0.09,
    effectDescription: '-10% EBITDA, -1.5% growth rate for one opco',
    tip: 'Thrasio\'s cultural failure led to mass exodus. Retention is cheaper than replacement.',
    tipSource: 'Ch. IX',
  },
  {
    type: 'portfolio_client_signs',
    title: 'Major Client Signs',
    description: 'One of your businesses lands a significant new contract.',
    probability: 0.08,
    effectDescription: '+8-12% EBITDA for one opco',
    tip: 'New clients are great, but watch concentration. No client should be irreplaceable.',
  },
  {
    type: 'portfolio_client_churns',
    title: 'Largest Client Churns',
    description: 'Your biggest customer at one of your businesses doesn\'t renew.',
    probability: 0.07,
    effectDescription: '-12-18% EBITDA for one opco (weighted by concentration)',
    tip: 'Client concentration is a hidden risk. Diversified revenue sleeps better at night.',
    tipSource: 'Ch. VII',
  },
  {
    type: 'portfolio_breakthrough',
    title: 'Operational Breakthrough',
    description: 'One of your teams discovers a significant efficiency improvement.',
    probability: 0.05,
    effectDescription: '+6% EBITDA permanent',
    tip: 'Danaher\'s DBS turns these moments into repeatable systems. Document what works.',
    tipSource: 'Ch. III',
  },
  {
    type: 'portfolio_compliance',
    title: 'Compliance Issue',
    description: 'A regulatory problem surfaces at one of your businesses.',
    probability: 0.04,
    effectDescription: '-8% EBITDA, costs $500k',
    tip: 'Compliance costs are predictable. Violations are not. Invest in prevention.',
  },
];

export interface SectorEventDefinition extends EventDefinition {
  sectorId: SectorId;
  ebitdaEffect: number | [number, number]; // single value or range
  growthEffect?: number;
  permanent?: boolean;
  affectsAll?: boolean; // true = all opcos in sector, false = one random opco
  costAmount?: number;
}

export const SECTOR_EVENTS: SectorEventDefinition[] = [
  // Agency events
  {
    type: 'sector_event',
    sectorId: 'agency',
    title: 'AI Tools Boost Margins',
    description: 'AI adoption accelerates delivery efficiency across your agencies.',
    probability: 0.04,
    effectDescription: '+8-15% EBITDA for all agencies',
    ebitdaEffect: [0.08, 0.15],
    affectsAll: true,
    tip: 'Agencies that embrace AI will outcompete those that don\'t. Invest in tools.',
  },
  {
    type: 'sector_event',
    sectorId: 'agency',
    title: 'Platform Algorithm Change',
    description: 'A major platform algorithm change disrupts client results.',
    probability: 0.04,
    effectDescription: '-5-12% EBITDA for all agencies',
    ebitdaEffect: [-0.12, -0.05],
    affectsAll: true,
    tip: 'Platform dependency is risk. Diversify channels when possible.',
  },
  {
    type: 'sector_event',
    sectorId: 'agency',
    title: 'Creative Director Poached',
    description: 'A competitor recruits your agency\'s key creative leader.',
    probability: 0.03,
    effectDescription: '-10% EBITDA, -2% growth for one agency',
    ebitdaEffect: -0.10,
    growthEffect: -0.02,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'agency',
    title: 'Industry Award Won',
    description: 'Your agency wins a major industry award, boosting reputation.',
    probability: 0.03,
    effectDescription: '+5% EBITDA, +3% growth for one agency',
    ebitdaEffect: 0.05,
    growthEffect: 0.03,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'agency',
    title: 'Client Consolidates Roster',
    description: 'A major client consolidates their agency roster and cuts your shop.',
    probability: 0.04,
    effectDescription: '-15% EBITDA for one agency',
    ebitdaEffect: -0.15,
    affectsAll: false,
  },

  // SaaS events
  {
    type: 'sector_event',
    sectorId: 'saas',
    title: 'Vertical SaaS Cash Machine',
    description: 'Customer retention hits 95%+. This product is a compounding machine.',
    probability: 0.04,
    effectDescription: '+10% EBITDA for one SaaS',
    ebitdaEffect: 0.10,
    affectsAll: false,
    tip: 'Vertical SaaS with high retention is the Constellation playbook. These are keepers.',
    tipSource: 'Ch. III',
  },
  {
    type: 'sector_event',
    sectorId: 'saas',
    title: 'Open-Source Competitor Emerges',
    description: 'A free alternative threatens your SaaS product\'s market position.',
    probability: 0.03,
    effectDescription: '-8% EBITDA, -3% growth for one SaaS',
    ebitdaEffect: -0.08,
    growthEffect: -0.03,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'saas',
    title: 'Enterprise Contract Signed',
    description: 'A major enterprise signs a 3-year contract.',
    probability: 0.04,
    effectDescription: '+12% EBITDA for one SaaS',
    ebitdaEffect: 0.12,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'saas',
    title: 'API Integration Breaks',
    description: 'A key integration partner changes their API, breaking your product.',
    probability: 0.03,
    effectDescription: '-10% EBITDA, costs $500k to fix',
    ebitdaEffect: -0.10,
    costAmount: 500,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'saas',
    title: 'Net Revenue Retention Soars',
    description: 'Expansion revenue drives NRR above 120%.',
    probability: 0.04,
    effectDescription: '+6% organic growth rate for one SaaS',
    ebitdaEffect: 0,
    growthEffect: 0.06,
    affectsAll: false,
  },

  // Home Services events
  {
    type: 'sector_event',
    sectorId: 'homeServices',
    title: 'Heat Wave Drives Demand',
    description: 'Extreme weather creates record service call volume.',
    probability: 0.04,
    effectDescription: '+10% EBITDA for home services',
    ebitdaEffect: 0.10,
    affectsAll: true,
  },
  {
    type: 'sector_event',
    sectorId: 'homeServices',
    title: 'New Housing Development',
    description: 'A major housing development opens in your service territory.',
    probability: 0.03,
    effectDescription: '+8% EBITDA, +2% growth',
    ebitdaEffect: 0.08,
    growthEffect: 0.02,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'homeServices',
    title: 'Technician Shortage',
    description: 'Labor market tightness drives up technician wages.',
    probability: 0.04,
    effectDescription: '-6% EBITDA for all home services',
    ebitdaEffect: -0.06,
    affectsAll: true,
  },
  {
    type: 'sector_event',
    sectorId: 'homeServices',
    title: 'Preferred Vendor Status',
    description: 'You win preferred vendor status with a property management group.',
    probability: 0.03,
    effectDescription: '+12% EBITDA for one business',
    ebitdaEffect: 0.12,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'homeServices',
    title: 'Seasonal Slowdown',
    description: 'Seasonal demand hits harder than expected this year.',
    probability: 0.04,
    effectDescription: '-5% EBITDA this year only',
    ebitdaEffect: -0.05,
    affectsAll: true,
  },

  // Consumer events
  {
    type: 'sector_event',
    sectorId: 'consumer',
    title: 'Brand Goes Viral',
    description: 'Social media sends your brand trending. Orders surge.',
    probability: 0.03,
    effectDescription: '+15% EBITDA for one brand (temporary)',
    ebitdaEffect: 0.15,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'consumer',
    title: 'Retailer Drops Product',
    description: 'A major retailer removes your product from their shelves.',
    probability: 0.03,
    effectDescription: '-12% EBITDA for one brand',
    ebitdaEffect: -0.12,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'consumer',
    title: 'Raw Materials Spike',
    description: 'Supply chain issues drive raw material costs up sharply.',
    probability: 0.04,
    effectDescription: '-8% EBITDA for all consumer brands',
    ebitdaEffect: -0.08,
    affectsAll: true,
  },
  {
    type: 'sector_event',
    sectorId: 'consumer',
    title: 'National Distribution Secured',
    description: 'Your brand secures national distribution at a major retailer.',
    probability: 0.03,
    effectDescription: '+10% EBITDA, +4% growth for one brand',
    ebitdaEffect: 0.10,
    growthEffect: 0.04,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'consumer',
    title: 'Category Trending',
    description: 'Consumer sentiment shifts favorably for your product category.',
    probability: 0.04,
    effectDescription: '+6% EBITDA for all consumer brands',
    ebitdaEffect: 0.06,
    affectsAll: true,
  },

  // Industrial events
  {
    type: 'sector_event',
    sectorId: 'industrial',
    title: 'Defense Contract Awarded',
    description: 'A government defense contract drives surge in aerospace orders.',
    probability: 0.04,
    effectDescription: '+12% EBITDA',
    ebitdaEffect: 0.12,
    affectsAll: false,
    tip: 'HEICO and TransDigm thrive on defense and aerospace aftermarket.',
    tipSource: 'Ch. III',
  },
  {
    type: 'sector_event',
    sectorId: 'industrial',
    title: 'Supply Chain Normalization',
    description: 'Supply chain improvements reduce lead times and costs.',
    probability: 0.04,
    effectDescription: '+5% EBITDA for all industrials',
    ebitdaEffect: 0.05,
    affectsAll: true,
  },
  {
    type: 'sector_event',
    sectorId: 'industrial',
    title: 'Customer Delays CapEx',
    description: 'A major customer delays their capital expenditure cycle.',
    probability: 0.03,
    effectDescription: '-8% EBITDA for one industrial',
    ebitdaEffect: -0.08,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'industrial',
    title: 'Lean Manufacturing Success',
    description: 'DBS-style operational improvements expand margins permanently.',
    probability: 0.03,
    effectDescription: '+6% EBITDA permanent',
    ebitdaEffect: 0.06,
    permanent: true,
    affectsAll: false,
    tip: 'The Danaher Business System turns operational excellence into compounding returns.',
    tipSource: 'Ch. III',
  },
  {
    type: 'sector_event',
    sectorId: 'industrial',
    title: 'Tariffs Increase Costs',
    description: 'New tariffs increase raw material import costs.',
    probability: 0.04,
    effectDescription: '-7% EBITDA for all industrials',
    ebitdaEffect: -0.07,
    affectsAll: true,
  },

  // B2B Services events
  {
    type: 'sector_event',
    sectorId: 'b2bServices',
    title: 'Multi-Year Contract Signed',
    description: 'A major client commits to a multi-year managed services agreement.',
    probability: 0.04,
    effectDescription: '+10% EBITDA for one B2B services co',
    ebitdaEffect: 0.10,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'b2bServices',
    title: 'Client In-Sources',
    description: 'A key client decides to bring your function in-house.',
    probability: 0.03,
    effectDescription: '-12% EBITDA for one business',
    ebitdaEffect: -0.12,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'b2bServices',
    title: 'Cybersecurity Demand Surge',
    description: 'A high-profile breach at a client drives demand for your MSP services.',
    probability: 0.03,
    effectDescription: '+8% EBITDA for IT services',
    ebitdaEffect: 0.08,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'b2bServices',
    title: 'Utilization Rate Soars',
    description: 'Consultant utilization hits 85%+, maximizing revenue per head.',
    probability: 0.04,
    effectDescription: '+6% EBITDA',
    ebitdaEffect: 0.06,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'b2bServices',
    title: 'Enterprise Procurement Freeze',
    description: 'Economic uncertainty causes enterprise clients to freeze vendor spend.',
    probability: 0.04,
    effectDescription: '-8% EBITDA for all B2B services',
    ebitdaEffect: -0.08,
    affectsAll: true,
  },

  // Healthcare events
  {
    type: 'sector_event',
    sectorId: 'healthcare',
    title: 'Medicare Rate Increase',
    description: 'CMS increases Medicare reimbursement rates by 3%.',
    probability: 0.04,
    effectDescription: '+6% EBITDA for all healthcare',
    ebitdaEffect: 0.06,
    affectsAll: true,
  },
  {
    type: 'sector_event',
    sectorId: 'healthcare',
    title: 'New Compliance Regulation',
    description: 'New healthcare regulations increase compliance costs.',
    probability: 0.04,
    effectDescription: '-8% EBITDA for all healthcare',
    ebitdaEffect: -0.08,
    affectsAll: true,
  },
  {
    type: 'sector_event',
    sectorId: 'healthcare',
    title: 'Physician Partner Retires',
    description: 'A key physician partner announces retirement.',
    probability: 0.03,
    effectDescription: '-10% EBITDA for one practice',
    ebitdaEffect: -0.10,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'healthcare',
    title: 'Value-Based Care Success',
    description: 'Your value-based care contract outperforms fee-for-service.',
    probability: 0.03,
    effectDescription: '+10% EBITDA for one practice',
    ebitdaEffect: 0.10,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'healthcare',
    title: 'Aging Demographics Boost',
    description: 'Demographic trends drive increased patient volume.',
    probability: 0.04,
    effectDescription: '+5% EBITDA for all healthcare',
    ebitdaEffect: 0.05,
    affectsAll: true,
  },

  // Restaurant events
  {
    type: 'sector_event',
    sectorId: 'restaurant',
    title: 'Delivery Partnership Success',
    description: 'A food delivery partnership drives 20% more orders.',
    probability: 0.04,
    effectDescription: '+10% EBITDA for one restaurant',
    ebitdaEffect: 0.10,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'restaurant',
    title: 'Food Cost Inflation',
    description: 'Food costs spike due to supply chain pressures.',
    probability: 0.04,
    effectDescription: '-8% EBITDA for all restaurants',
    ebitdaEffect: -0.08,
    affectsAll: true,
  },
  {
    type: 'sector_event',
    sectorId: 'restaurant',
    title: 'New Unit Exceeds Projections',
    description: 'A new restaurant location outperforms expectations.',
    probability: 0.03,
    effectDescription: '+12% EBITDA for one restaurant',
    ebitdaEffect: 0.12,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'restaurant',
    title: 'Health Inspection Issue',
    description: 'A health code violation forces temporary closure.',
    probability: 0.03,
    effectDescription: '-15% EBITDA for one restaurant (temporary)',
    ebitdaEffect: -0.15,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'restaurant',
    title: 'Loyalty Program Success',
    description: 'Your loyalty program drives repeat visits up 15%.',
    probability: 0.04,
    effectDescription: '+6% EBITDA, +2% growth for one restaurant',
    ebitdaEffect: 0.06,
    growthEffect: 0.02,
    affectsAll: false,
  },

  // Real Estate events
  {
    type: 'sector_event',
    sectorId: 'realEstate',
    title: 'Interest Rate Drop',
    description: 'Lower rates increase property valuations.',
    probability: 0.04,
    effectDescription: '+8% portfolio value for real estate',
    ebitdaEffect: 0.08,
    affectsAll: true,
    tip: 'Brookfield matches long-dated assets with long-dated debt. Duration matching is key.',
    tipSource: 'Ch. III',
  },
  {
    type: 'sector_event',
    sectorId: 'realEstate',
    title: 'Occupancy Hits 97%',
    description: 'Near-full occupancy gives you pricing power.',
    probability: 0.04,
    effectDescription: '+6% EBITDA for one property',
    ebitdaEffect: 0.06,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'realEstate',
    title: 'Major Tenant Vacates',
    description: 'A significant tenant doesn\'t renew their lease.',
    probability: 0.03,
    effectDescription: '-15% EBITDA for one property',
    ebitdaEffect: -0.15,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'realEstate',
    title: 'Infrastructure Concession',
    description: 'You\'re awarded a new 25-year infrastructure concession.',
    probability: 0.03,
    effectDescription: '+10% EBITDA',
    ebitdaEffect: 0.10,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'realEstate',
    title: 'Property Tax Reassessment',
    description: 'Tax reassessments increase property tax burden.',
    probability: 0.04,
    effectDescription: '-5% EBITDA for all real estate',
    ebitdaEffect: -0.05,
    affectsAll: true,
  },

  // Education events
  {
    type: 'sector_event',
    sectorId: 'education',
    title: 'Counter-Cyclical Enrollment Surge',
    description: 'Economic downturn drives enrollment surge as workers reskill.',
    probability: 0.04,
    effectDescription: '+10% EBITDA',
    ebitdaEffect: 0.10,
    affectsAll: true,
    tip: 'Education is counter-cyclical. When the economy struggles, people invest in themselves.',
  },
  {
    type: 'sector_event',
    sectorId: 'education',
    title: 'Accreditation Threat',
    description: 'A regulatory review threatens your accreditation status.',
    probability: 0.03,
    effectDescription: '-12% EBITDA for one education co',
    ebitdaEffect: -0.12,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'education',
    title: 'Corporate Training Partnership',
    description: 'A major employer partners with you for workforce training.',
    probability: 0.04,
    effectDescription: '+8% EBITDA for one business',
    ebitdaEffect: 0.08,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'education',
    title: 'Completion Rates Improve',
    description: 'Better completion rates boost reputation and referrals.',
    probability: 0.03,
    effectDescription: '+5% growth rate',
    ebitdaEffect: 0,
    growthEffect: 0.05,
    affectsAll: false,
  },
  {
    type: 'sector_event',
    sectorId: 'education',
    title: 'Free Alternatives Emerge',
    description: 'Free online courses erode your pricing power.',
    probability: 0.04,
    effectDescription: '-6% EBITDA for one education co',
    ebitdaEffect: -0.06,
    affectsAll: false,
  },
];

export function getEventsForSector(sectorId: SectorId): SectorEventDefinition[] {
  return SECTOR_EVENTS.filter(event => event.sectorId === sectorId);
}
